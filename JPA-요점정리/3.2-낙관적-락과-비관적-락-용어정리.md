# 낙관적 락과 비관적 락 - 용어 정리

> 내일 한번 더 정리할 예정이긴 하다. 오늘 일단은 시간이 없는 관계로 이것 저것 다 늘어서 적어놓았다.

데이터베이스들은 보통 READ COMMITTED 격리수준을 기본으로 사용한다. 이 기본값보다 더 높은 수준의 격리수준이 필요하면 낙관적 락, 비관적 락과 같은 락을 사용한다. 락은 데이터베이스의 트랜잭션이 제공하는 기능이다. JPA 는 DB의 기본 트랜잭션 격리 수준을 `READ COMMITTED` 정도로 가정한다. 만약 일부 로직에 더 높은 격리 수준이 필요하면 낙적락, 비관적 락 둘중 하나를 사용하면 된다.



## 낙관적 락

- JPA 가 제공하는 버전관리 기능을 사용하는 방식
- 애플리케이션이 제공하는 락
- 트랜잭션 커밋 전까지는 충돌을 알 수 없다. 
- DB에서 제공하는 락이 아니다.

<br>

## 비관적 락

- Ex) select for update
- 락을 걸고 트랜잭션을 시작
- ex) A,B 가 동시에 같은 공지사항을 열었을 때 A가 먼저 수정완료 버튼을 눌렀을 때
  - 잠시 후 B가 수정 완료를 클릭했다면 A의 수정내용은 분실된다. 즉, 나중에 수정한 B의 내용만 남게 된다.
- 이것을 "두번의 갱신분실문제" 라고 이야기한다. 트랜잭션만으로 해결 불가능하다. 아래의 3가지 옵션 중 하나를 선택해서 사용가능하다.
  - 마지막 커밋만 인정하기 (기본 전략)
  - 최초 커밋만 인정하기
    - JPA가 제공하는 버전관리 기능을 사용하면 손쉽게 최초 커밋만 인정하기를 구현할 수 있다.
  - 충돌하는 갱신 내용 병합하기
    - 최초 커밋만 인정하기를 우아하게 처리하는 방법이다.
    - 애플리케이션 개발자가 직접 사용자를 위한 병합 방법을 제공해야 한다. 